-- Platoboost Hub (Обводка + Aim Lock с Prediction)
print("Platoboost Hub Activated!")

-- Сервисы
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local UIS = game:GetService("UserInputService")

-- Настройки
local Settings = {
    ESP = true,
    AimLock = true,
    AimKey = "Q",
    MaxDistance = 99,
    AimFOV = 60,
    TeamCheck = false,
    Smoothness = 0.3,
    Prediction = 0.2 -- предугадывание движения в секундах
}

-- Только Highlight для обводки
local ESPHighlights = {}

-- Aim
local AimTarget = nil
local LastVelocity = Vector3.new(0,0,0)
local FOVCircle = Drawing.new("Circle")
FOVCircle.Visible = Settings.AimLock
FOVCircle.Radius = Settings.AimFOV
FOVCircle.Color = Color3.fromRGB(255, 255, 255)
FOVCircle.Thickness = 1
FOVCircle.Transparency = 0.5
FOVCircle.Filled = false
FOVCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)

-- Обновляем FOV круг
function UpdateFOVCircle()
    FOVCircle.Visible = Settings.AimLock
    FOVCircle.Radius = Settings.AimFOV
    FOVCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
end

-- Создаем GUI меню
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "PlatoboostHub"
ScreenGui.Parent = game:GetService("CoreGui")

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 300, 0, 220)
MainFrame.Position = UDim2.new(0, 10, 0, 10)
MainFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
MainFrame.BackgroundTransparency = 0.2
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 8)
UICorner.Parent = MainFrame

-- Заголовок
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 30)
Title.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
Title.Text = "Platoboost Hub"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.Code
Title.TextSize = 18
Title.Parent = MainFrame

-- Настройка бинда
local KeybindFrame = Instance.new("Frame")
KeybindFrame.Size = UDim2.new(1, -20, 0, 40)
KeybindFrame.Position = UDim2.new(0, 10, 0, 40)
KeybindFrame.BackgroundTransparency = 1
KeybindFrame.Parent = MainFrame

local KeybindLabel = Instance.new("TextLabel")
KeybindLabel.Size = UDim2.new(0.5, 0, 1, 0)
KeybindLabel.BackgroundTransparency = 1
KeybindLabel.Text = "Aim Key:"
KeybindLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
KeybindLabel.Font = Enum.Font.Code
KeybindLabel.TextSize = 14
KeybindLabel.TextXAlignment = Enum.TextXAlignment.Left
KeybindLabel.Parent = KeybindFrame

local KeybindBox = Instance.new("TextBox")
KeybindBox.Size = UDim2.new(0.5, -5, 1, 0)
KeybindBox.Position = UDim2.new(0.5, 5, 0, 0)
KeybindBox.BackgroundColor3 = Color3.fromRGB(70, 70, 80)
KeybindBox.Text = Settings.AimKey
KeybindBox.TextColor3 = Color3.fromRGB(255, 255, 255)
KeybindBox.Font = Enum.Font.Code
KeybindBox.TextSize = 14
KeybindBox.Parent = KeybindFrame

KeybindBox.FocusLost:Connect(function()
    if KeybindBox.Text ~= "" then
        Settings.AimKey = string.upper(string.sub(KeybindBox.Text, 1, 1))
        KeybindBox.Text = Settings.AimKey
    end
end)

-- ESP Toggle
local ESPToggle = Instance.new("TextButton")
ESPToggle.Size = UDim2.new(1, -20, 0, 40)
ESPToggle.Position = UDim2.new(0, 10, 0, 90)
ESPToggle.BackgroundColor3 = Settings.ESP and Color3.fromRGB(60, 180, 80) or Color3.fromRGB(180, 60, 70)
ESPToggle.Text = "ESP [" .. (Settings.ESP and "ON" or "OFF") .. "]"
ESPToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
ESPToggle.Font = Enum.Font.Code
ESPToggle.TextSize = 16
ESPToggle.Parent = MainFrame

local ESPCorner = Instance.new("UICorner")
ESPCorner.CornerRadius = UDim.new(0, 6)
ESPCorner.Parent = ESPToggle

-- Aim Lock Toggle
local AimToggle = Instance.new("TextButton")
AimToggle.Size = UDim2.new(1, -20, 0, 40)
AimToggle.Position = UDim2.new(0, 10, 0, 140)
AimToggle.BackgroundColor3 = Settings.AimLock and Color3.fromRGB(60, 180, 80) or Color3.fromRGB(180, 60, 70)
AimToggle.Text = "AIM LOCK [" .. (Settings.AimLock and "ON" or "OFF") .. "]"
AimToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
AimToggle.Font = Enum.Font.Code
AimToggle.TextSize = 16
AimToggle.Parent = MainFrame

local AimCorner = Instance.new("UICorner")
AimCorner.CornerRadius = UDim.new(0, 6)
AimCorner.Parent = AimToggle

-- Обработка переключателей
ESPToggle.MouseButton1Click:Connect(function()
    Settings.ESP = not Settings.ESP
    ESPToggle.Text = "ESP [" .. (Settings.ESP and "ON" or "OFF") .. "]"
    ESPToggle.BackgroundColor3 = Settings.ESP and Color3.fromRGB(60, 180, 80) or Color3.fromRGB(180, 60, 70)
    
    for _, highlight in pairs(ESPHighlights) do
        highlight.Enabled = Settings.ESP
    end
end)

AimToggle.MouseButton1Click:Connect(function()
    Settings.AimLock = not Settings.AimLock
    AimToggle.Text = "AIM LOCK [" .. (Settings.AimLock and "ON" or "OFF") .. "]"
    AimToggle.BackgroundColor3 = Settings.AimLock and Color3.fromRGB(60, 180, 80) or Color3.fromRGB(180, 60, 70)
    UpdateFOVCircle()
end)

-- Функция ESP (только обводка Highlight)
function UpdateESP()
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character then
            local distance = (player.Character.HumanoidRootPart.Position - Camera.CFrame.Position).Magnitude
            
            if distance <= Settings.MaxDistance then
                if not ESPHighlights[player] then
                    local highlight = Instance.new("Highlight")
                    highlight.FillColor = Color3.fromRGB(255, 255, 255)
                    highlight.FillTransparency = 0.9
                    highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
                    highlight.OutlineTransparency = 0
                    highlight.Parent = player.Character
                    ESPHighlights[player] = highlight
                end
                ESPHighlights[player].Enabled = Settings.ESP
            elseif ESPHighlights[player] then
                ESPHighlights[player].Enabled = false
            end
        elseif ESPHighlights[player] then
            ESPHighlights[player].Enabled = false
        end
    end
end

-- Aim Lock с предугадыванием
function GetClosestPlayer()
    local closest = nil
    local maxDist = Settings.AimFOV
    local screenCenter = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
    
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character then
            local head = player.Character:FindFirstChild("Head")
            local root = player.Character:FindFirstChild("HumanoidRootPart")
            if head and root then
                local pos, onScreen = Camera:WorldToViewportPoint(head.Position)
                if onScreen then
                    local dist = (Vector2.new(pos.X, pos.Y) - screenCenter).Magnitude
                    if dist <= maxDist then
                        if Settings.TeamCheck and player.Team == LocalPlayer.Team then
                            continue
                        end
                        closest = player
                        maxDist = dist
                        -- Сохраняем скорость для предугадывания
                        LastVelocity = root.Velocity
                    end
                end
            end
        end
    end
    return closest
end

-- Плавное прицеливание с предугадыванием
function SmoothAim(targetHead, prediction)
    if not targetHead then return end
    
    local headPos = targetHead.Position
    -- Добавляем предугадывание на основе скорости
    if prediction > 0 and LastVelocity then
        headPos = headPos + (LastVelocity * prediction)
    end
    
    local currentCFrame = Camera.CFrame
    local targetCFrame = CFrame.new(currentCFrame.Position, headPos)
    
    -- Плавная интерполяция
    Camera.CFrame = currentCFrame:Lerp(targetCFrame, Settings.Smoothness)
end

-- Aim Lock при зажатии клавиши
local Aiming = false

UIS.InputBegan:Connect(function(input)
    if input.KeyCode.Name == Settings.AimKey and Settings.AimLock then
        Aiming = true
        AimTarget = GetClosestPlayer()
        
        while Aiming and AimTarget and AimTarget.Character and Settings.AimLock do
            local head = AimTarget.Character:FindFirstChild("Head")
            SmoothAim(head, Settings.Prediction)
            RunService.RenderStepped:Wait()
        end
    end
end)

UIS.InputEnded:Connect(function(input)
    if input.KeyCode.Name == Settings.AimKey then
        Aiming = false
        AimTarget = nil
    end
end)

-- Основной цикл
RunService.RenderStepped:Connect(function()
    -- ESP обводка
    if Settings.ESP then
        UpdateESP()
    end
    
    -- Обновление FOV круга
    UpdateFOVCircle()
end)

-- Очистка
Players.PlayerRemoving:Connect(function(player)
    if ESPHighlights[player] then
        ESPHighlights[player]:Destroy()
        ESPHighlights[player] = nil
    end
end)

print("Platoboost Hub загружен! Нажми " .. Settings.AimKey .. " для Aim Lock.")
