-- Platoboost Hub для Roblox PC (требует поддержку Drawing и hookfunction)

-- Проверка исполнителя
if not drawing or not hookfunction then
    error("Нужен Synapse X / Script-Ware / KRNL")
end

print("Platoboost Hub Activated!")

-- Сервисы
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local RunService = game:GetService("RunService")

-- Настройки
local Settings = {
    ESP = true,
    AimLock = true,
    AimKey = "q",
    AimFOV = 60,
    TeamCheck = true,
    MaxDistance = 99
}

-- ESP (Drawing)
local ESPBoxes = {}
local ESPNames = {}

-- Создание ESP
function CreateESP(player)
    if ESPBoxes[player] then return end
    
    local Box = drawing.new("Square")
    Box.Visible = false
    Box.Color = Color3.fromRGB(255, 255, 255)
    Box.Thickness = 1
    Box.Filled = false
    Box.ZIndex = 10
    
    local Name = drawing.new("Text")
    Name.Visible = false
    Name.Color = Color3.fromRGB(255, 255, 255)
    Name.Size = 13
    Name.Center = true
    Name.Outline = true
    Name.ZIndex = 10
    
    ESPBoxes[player] = Box
    ESPNames[player] = Name
end

-- Обновление ESP
function UpdateESP()
    for player, Box in pairs(ESPBoxes) do
        local Name = ESPNames[player]
        
        if player and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local root = player.Character.HumanoidRootPart
            local pos, onScreen = Camera:WorldToViewportPoint(root.Position)
            local distance = (root.Position - Camera.CFrame.Position).Magnitude
            
            if onScreen and distance <= Settings.MaxDistance then
                local scale = 1000 / distance
                Box.Size = Vector2.new(10 * scale, 15 * scale)
                Box.Position = Vector2.new(pos.X - Box.Size.X / 2, pos.Y - Box.Size.Y / 2)
                Box.Visible = Settings.ESP
                
                Name.Position = Vector2.new(pos.X, pos.Y - Box.Size.Y / 2 - 10)
                Name.Text = player.Name .. " [" .. math.floor(distance) .. "]"
                Name.Visible = Settings.ESP
            else
                Box.Visible = false
                Name.Visible = false
            end
        else
            Box.Visible = false
            Name.Visible = false
        end
    end
end

-- Очистка ESP
function ClearESP()
    for _, Box in pairs(ESPBoxes) do
        Box:Remove()
    end
    for _, Name in pairs(ESPNames) do
        Name:Remove()
    end
    ESPBoxes = {}
    ESPNames = {}
end

-- Aim Lock (хук камеры)
local OriginalCameraCFrame
local AimTarget = nil
local FOVCircle = drawing.new("Circle")
FOVCircle.Radius = Settings.AimFOV
FOVCircle.Color = Color3.fromRGB(255, 255, 255)
FOVCircle.Thickness = 1
FOVCircle.Transparency = 0.5
FOVCircle.Filled = false
FOVCircle.Visible = Settings.AimLock
FOVCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)

-- Получение ближайшего игрока в FOV
function GetClosestPlayer()
    local closest = nil
    local maxDist = Settings.AimFOV
    local mousePos = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
    
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character then
            local head = player.Character:FindFirstChild("Head")
            if head then
                local pos, onScreen = Camera:WorldToViewportPoint(head.Position)
                if onScreen then
                    local dist = (Vector2.new(pos.X, pos.Y) - mousePos).Magnitude
                    if dist <= maxDist then
                        if Settings.TeamCheck and player.Team == LocalPlayer.Team then
                            continue
                        end
                        closest = player
                        maxDist = dist
                    end
                end
            end
        end
    end
    
    return closest
end

-- Хук функции камеры
if Settings.AimLock then
    local mt = getrawmetatable(game)
    local oldIndex = mt.__index
    
    setreadonly(mt, false)
    
    mt.__index = newcclosure(function(self, key)
        if key == "CFrame" and self == Camera and AimTarget then
            local targetHead = AimTarget.Character and AimTarget.Character:FindFirstChild("Head")
            if targetHead then
                return CFrame.new(Camera.CFrame.Position, targetHead.Position)
            end
        end
        return oldIndex(self, key)
    end)
    
    setreadonly(mt, true)
end

-- Обработка клавиши Aim
local UIS = game:GetService("UserInputService")
UIS.InputBegan:Connect(function(input)
    if input.KeyCode.Name == Settings.AimKey and Settings.AimLock then
        AimTarget = GetClosestPlayer()
    end
end)

UIS.InputEnded:Connect(function(input)
    if input.KeyCode.Name == Settings.AimKey then
        AimTarget = nil
    end
end)

-- Обновление FOV круга
function UpdateFOV()
    FOVCircle.Radius = Settings.AimFOV
    FOVCircle.Visible = Settings.AimLock
    FOVCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
end

-- GUI меню
local function CreateGUI()
    -- (Код GUI из предыдущего ответа, но с исправленными функциями переключателей)
    -- Убедись что кнопки меняют Settings.ESP и Settings.AimLock
end

-- Основной цикл
RunService.RenderStepped:Connect(function()
    -- ESP
    if Settings.ESP then
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and not ESPBoxes[player] then
                CreateESP(player)
            end
        end
        UpdateESP()
    else
        ClearESP()
    end
    
    -- FOV круг
    UpdateFOV()
    
    -- Aim Lock автообновление цели при удержании
    if UIS:IsKeyDown(Enum.KeyCode[Settings.AimKey:upper()]) and Settings.AimLock then
        AimTarget = GetClosestPlayer()
    end
end)

-- Очистка при выходе игрока
Players.PlayerRemoving:Connect(function(player)
    if ESPBoxes[player] then
        ESPBoxes[player]:Remove()
        ESPNames[player]:Remove()
        ESPBoxes[player] = nil
        ESPNames[player] = nil
    end
end)

print("Platoboost Hub loaded! Press " .. Settings.AimKey .. " for Aim Lock.")
