-- Platoboost Hub (Только обводка и Aim)
print("Platoboost Hub Activated!")

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

-- Настройки
local Settings = {
    ESP = true,
    AimLock = true,
    AimKey = "Q",
    MaxDistance = 200,
    AimFOV = 60,
    TeamCheck = false
}

-- Только обводка (Highlight)
local Highlights = {}

-- FOV круг (как в примере)
local FOVCircle = Drawing.new("Circle")
FOVCircle.Color = Color3.fromRGB(255, 255, 255)
FOVCircle.Thickness = 1
FOVCircle.Transparency = 0.5
FOVCircle.Filled = false
FOVCircle.Radius = Settings.AimFOV
FOVCircle.Visible = Settings.AimLock

-- Обновление позиции FOV круга
local function updateFOVCircle()
    local viewportSize = Camera.ViewportSize
    FOVCircle.Position = Vector2.new(viewportSize.X / 2, viewportSize.Y / 2)
    FOVCircle.Visible = Settings.AimLock
end

-- Проверка видимости (как в примере)
local function isTargetVisible(targetPart)
    local origin = Camera.CFrame.Position
    local direction = (targetPart.Position - origin).Unit * 1000
    local ray = Ray.new(origin, direction)
    local hit, position = workspace:FindPartOnRayWithIgnoreList(ray, {LocalPlayer.Character})
    return hit and hit:IsDescendantOf(targetPart.Parent)
end

-- Поиск ближайшего игрока в FOV
local function getClosestPlayer()
    local closest = nil
    local closestDist = Settings.AimFOV
    local center = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)

    for _, player in ipairs(Players:GetPlayers()) do
        if player == LocalPlayer then continue end
        if Settings.TeamCheck and player.Team == LocalPlayer.Team then continue end
        
        local char = player.Character
        if not char then continue end
        
        local head = char:FindFirstChild("Head")
        local humanoid = char:FindFirstChild("Humanoid")
        if not head or not humanoid or humanoid.Health <= 0 then continue end
        
        local screenPos, onScreen = Camera:WorldToViewportPoint(head.Position)
        if not onScreen then continue end
        
        local distance = (head.Position - Camera.CFrame.Position).Magnitude
        if distance > Settings.MaxDistance then continue end
        
        if not isTargetVisible(head) then continue end
        
        local distToCenter = (Vector2.new(screenPos.X, screenPos.Y) - center).Magnitude
        if distToCenter < closestDist then
            closest = player
            closestDist = distToCenter
        end
    end
    
    return closest
end

-- Обновление ESP (только обводка)
local function updateESP()
    for _, player in ipairs(Players:GetPlayers()) do
        if player == LocalPlayer then continue end
        
        local char = player.Character
        if not char then
            if Highlights[player] then
                Highlights[player].Enabled = false
            end
            continue
        end
        
        local humanoid = char:FindFirstChild("Humanoid")
        if not humanoid or humanoid.Health <= 0 then
            if Highlights[player] then
                Highlights[player].Enabled = false
            end
            continue
        end
        
        local distance = (char.HumanoidRootPart.Position - Camera.CFrame.Position).Magnitude
        if distance > Settings.MaxDistance then
            if Highlights[player] then
                Highlights[player].Enabled = false
            end
            continue
        end
        
        if not Highlights[player] then
            local highlight = Instance.new("Highlight")
            highlight.FillColor = Color3.fromRGB(255, 255, 255)
            highlight.FillTransparency = 0.9
            highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
            highlight.OutlineTransparency = 0
            highlight.Parent = char
            Highlights[player] = highlight
        end
        
        Highlights[player].Enabled = Settings.ESP
    end
end

-- Aim Lock (как в примере)
local Aiming = false

UIS.InputBegan:Connect(function(input)
    if input.KeyCode.Name == Settings.AimKey and Settings.AimLock then
        Aiming = true
        
        while Aiming and Settings.AimLock do
            local target = getClosestPlayer()
            if target and target.Character then
                local head = target.Character:FindFirstChild("Head")
                if head then
                    -- Мгновенный поворот камеры (как в примере)
                    local targetCFrame = CFrame.new(Camera.CFrame.Position, head.Position)
                    Camera.CFrame = Camera.CFrame:Lerp(targetCFrame, 1)
                end
            end
            RunService.RenderStepped:Wait()
        end
    end
end)

UIS.InputEnded:Connect(function(input)
    if input.KeyCode.Name == Settings.AimKey then
        Aiming = false
    end
end)

-- GUI меню
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Parent = game:GetService("CoreGui")

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 180, 0, 100)
MainFrame.Position = UDim2.new(0, 10, 0, 10)
MainFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
MainFrame.BackgroundTransparency = 0.2
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui

local ESPBtn = Instance.new("TextButton")
ESPBtn.Size = UDim2.new(1, -10, 0, 35)
ESPBtn.Position = UDim2.new(0, 5, 0, 5)
ESPBtn.BackgroundColor3 = Settings.ESP and Color3.fromRGB(60, 180, 80) or Color3.fromRGB(180, 60, 80)
ESPBtn.Text = "ESP: " .. (Settings.ESP and "ON" or "OFF")
ESPBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
ESPBtn.Font = Enum.Font.Code
ESPBtn.TextSize = 14
ESPBtn.Parent = MainFrame

local AimBtn = Instance.new("TextButton")
AimBtn.Size = UDim2.new(1, -10, 0, 35)
AimBtn.Position = UDim2.new(0, 5, 0, 45)
AimBtn.BackgroundColor3 = Settings.AimLock and Color3.fromRGB(60, 180, 80) or Color3.fromRGB(180, 60, 80)
AimBtn.Text = "AIM: " .. (Settings.AimLock and "ON" or "OFF")
AimBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
AimBtn.Font = Enum.Font.Code
AimBtn.TextSize = 14
AimBtn.Parent = MainFrame

ESPBtn.MouseButton1Click:Connect(function()
    Settings.ESP = not Settings.ESP
    ESPBtn.Text = "ESP: " .. (Settings.ESP and "ON" or "OFF")
    ESPBtn.BackgroundColor3 = Settings.ESP and Color3.fromRGB(60, 180, 80) or Color3.fromRGB(180, 60, 80)
end)

AimBtn.MouseButton1Click:Connect(function()
    Settings.AimLock = not Settings.AimLock
    AimBtn.Text = "AIM: " .. (Settings.AimLock and "ON" or "OFF")
    AimBtn.BackgroundColor3 = Settings.AimLock and Color3.fromRGB(60, 180, 80) or Color3.fromRGB(180, 60, 80)
    FOVCircle.Visible = Settings.AimLock
end)

-- Основной цикл
RunService.RenderStepped:Connect(function()
    updateFOVCircle()
    if Settings.ESP then
        updateESP()
    end
end)

-- Очистка
Players.PlayerRemoving:Connect(function(player)
    if Highlights[player] then
        Highlights[player]:Destroy()
        Highlights[player] = nil
    end
end)

print("Platoboost Hub загружен. Нажми " .. Settings.AimKey .. " для Aim Lock.")
